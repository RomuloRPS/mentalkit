<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title *ngIf="editing">Editar Informe de Despesa</ion-title>
    <ion-title *ngIf="!editing">Criar Infome de Despesa</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content color="light">

  <ion-slides pager="true" [options]="slideOpts">
    <ion-slide *ngIf="expenseReport?.getRelation('avatar')" (click)="openOptions($event)">
      <img style="height: 150px;" class="rounded-md h-full m-4"  [src]="expenseReport.getRelation('avatar')?.getAttribute('token') | attachmentToken">
    </ion-slide>
    <ion-slide *ngFor="let attachment of attachments; let i = index" (click)="openOptions($event, i)">
      <img *ngIf="attachment.file" style="height: 150px;" class="rounded-md h-full m-4"  [src]="attachment.file | safeHtml">
    </ion-slide>
    <ion-slide *ngFor="let attachment of attachments; let i = index" (click)="openOptions($event, i)">
      <img *ngIf="attachment.file" style="height: 150px;" class="rounded-md h-full m-4"  [src]="attachment.file | safeHtml">
    </ion-slide>
    <ion-slide (click)="openOptions($event)">
      <div class="h-40 border-2 border-dotted border-ultramarine-500 w-full m-2 rounded-md">
        <ion-icon color="primary" class="text-6xl m-auto mt-2" src="/assets/fontawesome/solid/images.svg"></ion-icon>
        <p class="font-bold text-ultramarine-500">Incluir foto</p>
        <p class="text-sm text-ultramarine-500">JPG, GIF e PNG somente</p>
      </div>
      <!-- <img style="height: 150px;" *ngIf="expenseReport?.getRelation('avatar')?.getAttribute('token')" [src]="getIconUrl(expenseReport?.getRelation('avatar')?.getAttribute('token'))" /> -->
    </ion-slide>
  </ion-slides>

  <form *ngIf="expenseReport" class="mt-6" #expenseReportForm="ngForm" name="expenseReportForm">
    <ion-row class="flex justify-center ">
      <ion-col size="11">
        <ion-item lines="none" class="rounded-lg">
          <ion-icon slot="start" color="tertiary" name="pencil-outline"></ion-icon>
          <ion-label>Motivo/Descrição: </ion-label>
          <ion-input #name="ngModel"  [(ngModel)]="expenseReport.elements.name" name="name" type="text" 
            spellcheck="false" autocapitalize="off" required>
          </ion-input>
        </ion-item>
        <ion-text color="danger">
          <p [hidden]="name.valid || submitted == false" class="ion-padding-start">
            Campo Obrigatório
          </p>
        </ion-text>
      </ion-col>

      <ion-col size="11">
        <app-ev-select [value]="policy" iconColor="tertiary" icon="../../../assets/fontawesome/solid/bars.svg" showField="name" placeholder="Política"
        (valueChange)="selectPolicy($event)" [(valueId)]="selectedPolicyId" inputName='Política' [baseService]="policyService"
        #roleSelect></app-ev-select>
        <ion-text color="danger">
          <p [hidden]="this.expenseReport.getRelation('policy') || submitted == false" class="ion-padding-start">
            Campo Obrigatório
          </p>
        </ion-text>
      </ion-col>

      <ion-col size="11">
        <app-ev-select [value]="department" iconColor="tertiary" icon="../../../assets/fontawesome/solid/bars.svg" showField="name" placeholder="Departamento"
        (valueChange)="selectDepartment($event)" [(valueId)]="selectedDepartmentId" inputName='Departamento' [baseService]="departmentService"
        #roleSelect></app-ev-select>
      </ion-col>

      <ion-col size="11">
        <app-ev-select [value]="costCenter" iconColor="tertiary" icon="../../../assets/fontawesome/solid/bars.svg" showField="name" placeholder="Centro de Custo"
        (valueChange)="selectCostCenter($event)" [(valueId)]="selectedCostCenterId" inputName='Centro de Custo' [baseService]="costCenterService"
        #roleSelect></app-ev-select>
      </ion-col>

      <ion-col size="11">
        <app-ev-multi-select-expenses [filters]="expenseFilters" [values]="expenses" iconColor="tertiary" icon="../../../assets/fontawesome/solid/cash-register.svg" showField="name" placeholder="Despesas"
        (valueChange)="selectExpenses($event)" [(valueId)]="selectedExpenses" inputName='Expenses' [baseService]="expenseService"
        #roleSelect></app-ev-multi-select-expenses>
      </ion-col>

    </ion-row>
  </form>

</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-row>
      <ion-col size="6">
        <ion-button (click)="backToList()" fill="outline" color="danger" expand="block">
          Cancelar
        </ion-button>
      </ion-col>
      <ion-col *ngIf="!editing" size="6">
        <ion-button (click)="create(expenseReportForm)"  expand="block">
          Criar
        </ion-button>
      </ion-col>
      <ion-col *ngIf="editing" size="6">
        <ion-button (click)="save(expenseReportForm)"  expand="block">
          Salvar
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-toolbar>
</ion-footer>

